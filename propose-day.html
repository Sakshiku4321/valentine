<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hide & Seek Proposal</title>
  <meta name="theme-color" content="#f7d8e6" />
  <style>
    /* =========================================================
       Propose Day ‚Äî Hide & Seek Proposal (HTML/CSS/JS only)
       Romantic dreamy palette: rose / cream / lavender / gold
       Fully responsive + lightweight animations
    ========================================================= */

    :root{
      --rose:#f7b7cf;
      --rose-2:#ff8fb8;
      --cream:#fff7ef;
      --lav:#d8c9ff;
      --ink:#3a2a3f;
      --gold:rgba(255, 208, 120, .75);
      --glass: rgba(255,255,255,.58);
      --glass-2: rgba(255,255,255,.35);
      --shadow: 0 18px 50px rgba(24, 10, 33, .18);
      --shadow-soft: 0 10px 30px rgba(24, 10, 33, .12);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      overflow-x:hidden;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255, 170, 210,.55), transparent 55%),
        radial-gradient(1000px 700px at 90% 20%, rgba(216, 201, 255,.65), transparent 55%),
        radial-gradient(900px 650px at 40% 95%, rgba(255, 247, 239,.85), transparent 60%),
        linear-gradient(180deg, #fff 0%, #fff5fb 30%, #fff8f1 100%);
      position:relative;
    }

    /* Soft grain for dreamy feel */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.14;
      mix-blend-mode:multiply;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.5'/%3E%3C/svg%3E");
    }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:28px 16px 42px;
      position:relative;
    }

    .card{
      width:min(860px, 100%);
      border-radius:var(--radius);
      background:linear-gradient(180deg, var(--glass), var(--glass-2));
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,.6);
      overflow:hidden;
      position:relative;
    }

    .card::after{
      /* subtle golden edge sparkle */
      content:"";
      position:absolute;
      inset:-2px;
      border-radius:calc(var(--radius) + 2px);
      pointer-events:none;
      background:
        radial-gradient(500px 200px at 20% 0%, rgba(255,208,120,.55), transparent 60%),
        radial-gradient(400px 220px at 90% 10%, rgba(255,208,120,.35), transparent 70%),
        radial-gradient(500px 260px at 50% 120%, rgba(255,208,120,.35), transparent 70%);
      opacity:.55;
      mix-blend-mode:soft-light;
    }

    header{
      padding:22px 22px 12px;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      position:relative;
      z-index:2;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }

    .seal{
      width:44px;height:44px;
      border-radius:16px;
      background:
        radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.4) 45%, rgba(255,255,255,0) 60%),
        linear-gradient(145deg, rgba(255,143,184,.95), rgba(216,201,255,.95));
      box-shadow:var(--shadow-soft);
      border:1px solid rgba(255,255,255,.7);
      position:relative;
      overflow:hidden;
    }
    .seal::before{
      content:"";
      position:absolute;
      inset:-30%;
      background:conic-gradient(from 90deg, rgba(255,255,255,.0), rgba(255,255,255,.6), rgba(255,255,255,.0));
      animation: shimmer 5.5s linear infinite;
      opacity:.55;
    }
    @keyframes shimmer{to{transform:rotate(360deg)}}

    .brand h1{
      margin:0;
      font-size:clamp(18px, 3.2vw, 24px);
      letter-spacing:.2px;
    }
    .brand p{
      margin:4px 0 0;
      font-size:13.5px;
      opacity:.75;
    }

    /* Music toggle */
    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }
    .pill{
      border:1px solid rgba(255,255,255,.7);
      background:rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
      border-radius:999px;
      padding:10px 12px;
      display:flex;
      gap:10px;
      align-items:center;
      box-shadow:0 10px 22px rgba(30, 9, 25, .10);
      user-select:none;
    }
    .pill button{
      border:0;
      background:transparent;
      color:var(--ink);
      font-weight:650;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      padding:0;
      font-size:13px;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background:rgba(58, 42, 63, .25);
      box-shadow: 0 0 0 6px rgba(255,143,184,.12);
      transition:.25s ease;
    }
    .dot.on{
      background:rgba(255, 90, 160, .9);
      box-shadow: 0 0 0 7px rgba(255,143,184,.22), 0 0 16px rgba(255,143,184,.55);
    }

    main{
      padding:10px 22px 24px;
      position:relative;
      z-index:2;
    }

    .hero{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
      align-items:stretch;
      margin-top:8px;
    }

    @media (max-width: 860px){
      .hero{grid-template-columns:1fr; gap:14px;}
      header{flex-direction:column; align-items:stretch;}
      .controls{justify-content:flex-start;}
    }

    .panel{
      background:rgba(255,255,255,.50);
      border:1px solid rgba(255,255,255,.65);
      border-radius:20px;
      box-shadow:0 12px 26px rgba(30, 9, 25, .08);
      overflow:hidden;
      position:relative;
      padding:18px;
    }

    .prompt{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .prompt .tag{
      display:inline-flex;
      width:max-content;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:linear-gradient(135deg, rgba(255,143,184,.28), rgba(216,201,255,.28));
      border:1px solid rgba(255,255,255,.65);
      font-size:13px;
      letter-spacing:.2px;
    }

    .locked{
      margin-top:4px;
      padding:18px 16px;
      border-radius:18px;
      border:1px dashed rgba(58, 42, 63, .22);
      background:
        radial-gradient(700px 300px at 20% 0%, rgba(255,143,184,.22), transparent 60%),
        radial-gradient(700px 300px at 90% 20%, rgba(216,201,255,.28), transparent 60%),
        rgba(255,255,255,.42);
      position:relative;
      overflow:hidden;
    }

    .locked h2{
      margin:0;
      font-size:clamp(18px, 3.6vw, 28px);
      line-height:1.2;
      letter-spacing:.2px;
      filter: blur(7px);
      opacity:.55;
      transform: translateZ(0);
      transition: .8s ease;
    }
    .locked .sub{
      margin:8px 0 0;
      opacity:.75;
      font-size:14px;
    }

    .progressRow{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:14px;
      flex-wrap:wrap;
    }
    .steps{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .step{
      width:10px;height:10px;border-radius:999px;
      background:rgba(58, 42, 63, .18);
      border:1px solid rgba(255,255,255,.7);
      transition:.35s ease;
    }
    .step.done{
      background:linear-gradient(180deg, rgba(255,143,184,.95), rgba(216,201,255,.9));
      box-shadow:0 0 0 6px rgba(255,143,184,.15);
    }
    .hint{
      font-size:13.5px;
      opacity:.8;
    }

    /* Right side: play area */
    .playArea{
      min-height:260px;
      display:grid;
      place-items:center;
      position:relative;
      isolation:isolate;
    }
    .playArea .softNote{
      position:absolute;
      top:14px; left:14px; right:14px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      font-size:13px;
      opacity:.75;
      pointer-events:none;
    }

    .board{
      width:100%;
      height:310px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.65);
      background:
        radial-gradient(900px 360px at 30% 20%, rgba(255,143,184,.20), transparent 55%),
        radial-gradient(800px 320px at 85% 30%, rgba(216,201,255,.22), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.35));
      overflow:hidden;
      position:relative;
      box-shadow:0 12px 26px rgba(30, 9, 25, .08);
    }

    @media (max-width: 860px){
      .board{height:320px;}
    }

    /* Floating decorative particles */
    .floaty{
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.9;
      z-index:1;
    }
    .floaty span{
      position:absolute;
      font-size:18px;
      opacity:.65;
      animation: drift var(--dur) ease-in-out infinite;
      filter: drop-shadow(0 8px 14px rgba(30,9,25,.12));
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      0%,100%{transform:translate(var(--x1), var(--y1)) scale(var(--s));}
      50%{transform:translate(var(--x2), var(--y2)) scale(calc(var(--s) + .06));}
    }

    /* Clickable "seek" items */
    .seek{
      position:absolute;
      width:78px;
      height:64px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.65);
      background:rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
      box-shadow:0 16px 30px rgba(30, 9, 25, .14);
      cursor:pointer;
      display:grid;
      place-items:center;
      transition: transform .25s ease, box-shadow .25s ease, opacity .35s ease;
      user-select:none;
      z-index:3;
    }
    .seek:focus{outline: 3px solid rgba(255, 143, 184, .35); outline-offset: 2px;}
    .seek:hover{transform: translateY(-3px) rotate(-.4deg); box-shadow:0 20px 40px rgba(30, 9, 25, .18);}
    .seek .icon{font-size:24px}
    .seek .mini{
      position:absolute;
      bottom:-10px;
      right:-10px;
      width:28px;height:28px;
      border-radius:999px;
      background:linear-gradient(145deg, rgba(255,143,184,.95), rgba(216,201,255,.95));
      border:1px solid rgba(255,255,255,.75);
      display:grid;
      place-items:center;
      color:#fff;
      font-size:14px;
      box-shadow:0 14px 26px rgba(30, 9, 25, .16);
    }

    .seek.found{
      opacity:0;
      transform:scale(.85);
      pointer-events:none;
    }

    .toast{
      position:absolute;
      left:50%;
      top:58%;
      transform: translate(-50%, -50%);
      padding:10px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.74);
      border:1px solid rgba(255,255,255,.8);
      box-shadow:0 18px 44px rgba(30, 9, 25, .14);
      font-size:13.5px;
      opacity:0;
      pointer-events:none;
      z-index:4;
      transition: opacity .25s ease, transform .25s ease;
      white-space:nowrap;
    }
    .toast.show{
      opacity:1;
      transform: translate(-50%, -58%);
    }

    /* Final reveal overlay */
    .reveal{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      background:
        radial-gradient(900px 420px at 30% 20%, rgba(255,143,184,.25), transparent 60%),
        radial-gradient(900px 420px at 80% 30%, rgba(216,201,255,.25), transparent 60%),
        rgba(255,255,255,.35);
      opacity:0;
      pointer-events:none;
      transition: opacity .7s ease;
      z-index:5;
    }
    .reveal.on{
      opacity:1;
      pointer-events:auto;
    }

    .proposalBox{
      width:min(520px, calc(100% - 26px));
      border-radius:24px;
      border:1px solid rgba(255,255,255,.75);
      background:linear-gradient(180deg, rgba(255,255,255,.82), rgba(255,255,255,.55));
      box-shadow: 0 30px 70px rgba(30, 9, 25, .18);
      padding:18px 18px 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
      transform: translateY(10px) scale(.98);
      transition: transform .7s cubic-bezier(.2,.8,.2,1);
    }
    .reveal.on .proposalBox{
      transform: translateY(0) scale(1);
    }

    .proposalBox::before{
      content:"";
      position:absolute;
      inset:-30%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255, 208, 120, .35), transparent 60%),
        radial-gradient(circle at 70% 40%, rgba(255, 143, 184, .25), transparent 60%),
        radial-gradient(circle at 50% 85%, rgba(216, 201, 255, .25), transparent 60%);
      filter: blur(6px);
      opacity:.9;
      pointer-events:none;
    }

    .proposal{
      position:relative;
      z-index:2;
      padding:6px 8px 0;
    }
    .proposal .big{
      margin:0;
      font-size:clamp(26px, 5vw, 40px);
      line-height:1.12;
      letter-spacing:.2px;
      text-shadow:0 16px 40px rgba(30, 9, 25, .12);
    }
    .proposal .line{
      margin:10px 0 0;
      font-size:14.5px;
      opacity:.78;
    }

    .actions{
      position:relative;
      z-index:2;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .btn{
      border:0;
      border-radius:999px;
      padding:12px 16px;
      font-weight:750;
      cursor:pointer;
      transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
      box-shadow:0 16px 30px rgba(30, 9, 25, .14);
    }
    .btn:active{transform: translateY(1px) scale(.99)}
    .btn.primary{
      color:#fff;
      background:linear-gradient(135deg, rgba(255, 110, 175, 1), rgba(140, 115, 255, 1));
    }
    .btn.ghost{
      background:rgba(255,255,255,.72);
      border:1px solid rgba(255,255,255,.85);
      color:var(--ink);
      box-shadow:0 14px 26px rgba(30, 9, 25, .10);
    }
    .btn:hover{filter:brightness(1.02); transform: translateY(-2px);}

    /* Heartbeat on final message */
    .heartbeat{
      display:inline-block;
      animation: beat 1.1s ease-in-out infinite;
      transform-origin:center;
    }
    @keyframes beat{
      0%,100%{transform:scale(1)}
      25%{transform:scale(1.035)}
      40%{transform:scale(1)}
      60%{transform:scale(1.055)}
    }

    /* Confetti/hearts canvas area */
    canvas#fx{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:999;
    }

    /* Footer note */
    footer{
      padding:0 22px 22px;
      position:relative;
      z-index:2;
    }
    .footerRow{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      opacity:.75;
      font-size:12.5px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      background:rgba(255,255,255,.55);
      border:1px solid rgba(255,255,255,.7);
      border-radius:10px;
      padding:4px 8px;
    }

    @media (prefers-reduced-motion: reduce){
      *{animation:none !important; transition:none !important; scroll-behavior:auto !important}
      .locked h2{filter:none; opacity:1}
    }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>

  <div class="wrap">
    <section class="card" aria-label="Hide and seek proposal landing page">
      <header>
        <div class="brand">
          <div class="seal" aria-hidden="true"></div>
          <div>
            <h1>Propose Day ‚Äî Hide &amp; Seek Love Game</h1>
            <p>Find the hidden clues‚Ä¶ and unlock what my heart has been holding.</p>
          </div>
        </div>

        <div class="controls">
          <div class="pill" role="group" aria-label="Music controls">
            <span class="dot" id="musicDot" aria-hidden="true"></span>
            <button id="musicBtn" type="button" aria-pressed="false" title="Toggle music">
              <span id="musicIcon" aria-hidden="true">üîá</span>
              <span id="musicLabel">Music: Off</span>
            </button>
          </div>
        </div>
      </header>

      <main>
        <div class="hero">
          <!-- Left: locked message + progress -->
          <section class="panel">
            <div class="prompt">
              <div class="tag">üåπ Propose Day Special ‚Ä¢ dreamy ‚Ä¢ playful</div>

              <div class="locked" aria-live="polite">
                <h2 id="lockedText">Will you be mine forever? üíç‚ù§Ô∏è</h2>
                <p class="sub" id="lockedSub">Something is hiding‚Ä¶ can you find it? üëÄüíå</p>

                <div class="progressRow">
                  <div class="steps" aria-label="Progress">
                    <div class="step" id="s1"></div>
                    <div class="step" id="s2"></div>
                    <div class="step" id="s3"></div>
                    <div class="step" id="s4"></div>
                  </div>
                  <div class="hint" id="hintText">Tip: tap the floating cards on the right ‚ú®</div>
                </div>
              </div>

              <div style="font-size:13.5px; opacity:.78; line-height:1.5;">
                <strong>How it works:</strong> Each time you find a hidden card, the message gets clearer.
                After a few finds, it reveals the real question.
              </div>
            </div>
          </section>

          <!-- Right: interactive board -->
          <section class="panel playArea">
            <div class="softNote">
              <span>Hide &amp; Seek board</span>
              <span><span class="kbd">Tap</span> ‚Ä¢ <span class="kbd">Hover</span> ‚Ä¢ <span class="kbd">Find</span></span>
            </div>

            <div class="board" id="board" aria-label="Interactive hide and seek area">
              <!-- Decorative floaties -->
              <div class="floaty" aria-hidden="true" id="floaty"></div>

              <!-- Clickable items (positions set via JS for responsiveness) -->
              <button class="seek" id="item1" type="button" aria-label="Hidden clue 1">
                <span class="icon">üíå</span><span class="mini">1</span>
              </button>
              <button class="seek" id="item2" type="button" aria-label="Hidden clue 2">
                <span class="icon">üí´</span><span class="mini">2</span>
              </button>
              <button class="seek" id="item3" type="button" aria-label="Hidden clue 3">
                <span class="icon">üíó</span><span class="mini">3</span>
              </button>
              <button class="seek" id="item4" type="button" aria-label="Hidden clue 4">
                <span class="icon">üåô</span><span class="mini">4</span>
              </button>

              <div class="toast" id="toast" role="status" aria-live="polite"></div>

              <!-- Final reveal overlay -->
              <div class="reveal" id="reveal" aria-hidden="true">
                <div class="proposalBox">
                  <div class="proposal">
                    <h2 class="big">
                      <span class="heartbeat">Will you be mine forever?</span> üíç‚ù§Ô∏è
                    </h2>
                    <p class="line">Take your time‚Ä¶ but my heart already knows üíï</p>
                  </div>
                  <div class="actions">
                    <button class="btn primary" id="yesBtn" type="button">YES üíñ</button>
                    <button class="btn ghost" id="againBtn" type="button">Replay ‚ú®</button>
                  </div>
                  <p class="line" style="margin-top:10px; opacity:.7;">
                    (P.S. You just unlocked the sweetest secret.)
                  </p>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>

      <footer>
        <div class="footerRow">
          <span>Made with rose-pink courage + lavender dreams.</span>
          <span>Accessibility: keyboard friendly ‚Ä¢ reduced motion supported</span>
        </div>
      </footer>
    </section>
  </div>

  <script>
    /* =========================================================
       Hide & Seek Proposal Logic
       - 4 hidden items ‚Üí 4 steps of reveal
       - Toast hints after interactions
       - Final overlay with YES + replay
       - Optional soft background music with toggle
       - Confetti/heart celebration on YES
    ========================================================= */

    // ---------- Helpers ----------
    const $ = (sel) => document.querySelector(sel);

    const lockedText = $("#lockedText");
    const lockedSub  = $("#lockedSub");
    const hintText   = $("#hintText");
    const toast      = $("#toast");
    const reveal     = $("#reveal");

    const steps = [$("#s1"), $("#s2"), $("#s3"), $("#s4")];
    const items = [$("#item1"), $("#item2"), $("#item3"), $("#item4")];

    const board = $("#board");

    let foundCount = 0;
    let toastTimer = null;

    const clueLines = [
      "Almost there üí´",
      "Look again üòâ",
      "My favorite person is getting warmer üíó",
      "One last little secret‚Ä¶ üåô"
    ];

    function showToast(message){
      toast.textContent = message;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove("show"), 1200);
    }

    function setLockedBlur(level){
      // level: 0..4 (more found = less blur)
      // nice, gentle "unlock"
      const blur = [7, 5.5, 4, 2.3, 0][level];
      const op   = [0.55, 0.62, 0.72, 0.86, 1][level];
      lockedText.style.filter = `blur(${blur}px)`;
      lockedText.style.opacity = op;
      lockedText.style.transform = level >= 4 ? "scale(1.01)" : "none";
    }

    function updateProgress(){
      steps.forEach((s, i) => s.classList.toggle("done", i < foundCount));

      if(foundCount === 0){
        lockedSub.textContent = "Something is hiding‚Ä¶ can you find it? üëÄüíå";
        hintText.textContent = "Tip: tap the floating cards on the right ‚ú®";
        setLockedBlur(0);
        reveal.classList.remove("on");
        reveal.setAttribute("aria-hidden","true");
        return;
      }

      if(foundCount < 4){
        lockedSub.textContent = "Keep going‚Ä¶ the message is getting clearer üíû";
        hintText.textContent = `Clues found: ${foundCount}/4`;
        setLockedBlur(foundCount);
        return;
      }

      // Final reveal
      setLockedBlur(4);
      lockedSub.textContent = "You found it. Now look at me (through the screen) ü•∫üíñ";
      hintText.textContent = "Unlocked ‚ú®";
      reveal.classList.add("on");
      reveal.setAttribute("aria-hidden","false");
      showToast("Unlocked üíç‚ù§Ô∏è");
    }

    // ---------- Random positioning for items (responsive) ----------
    // Keep them within the board safely, not under the overlay text.
    function placeItems(){
      const rect = board.getBoundingClientRect();
      const pad = 18;

      // Zones (percentage positions) - handcrafted so it feels like hide & seek
      const spots = [
        {x: 0.12, y: 0.58},
        {x: 0.70, y: 0.18},
        {x: 0.52, y: 0.70},
        {x: 0.22, y: 0.18},
      ];

      items.forEach((btn, i) => {
        const w = btn.offsetWidth || 78;
        const h = btn.offsetHeight || 64;

        const base = spots[i];
        // small randomness each load
        const jitterX = (Math.random() - 0.5) * 0.10;
        const jitterY = (Math.random() - 0.5) * 0.10;

        const x = (base.x + jitterX) * rect.width;
        const y = (base.y + jitterY) * rect.height;

        const left = Math.max(pad, Math.min(rect.width  - w - pad, x));
        const top  = Math.max(pad + 14, Math.min(rect.height - h - pad, y));

        btn.style.left = left + "px";
        btn.style.top  = top  + "px";
      });
    }

    // ---------- Floaty decorations ----------
    function buildFloaties(){
      const floaty = $("#floaty");
      const icons = ["üíó","‚ú®","üíå","‚≠ê","üå∑","üí´","ü§ç","üåô"];
      const count = 14;

      floaty.innerHTML = "";
      for(let i=0; i<count; i++){
        const s = document.createElement("span");
        s.textContent = icons[Math.floor(Math.random()*icons.length)];

        const x1 = `${Math.random()*100}%`;
        const y1 = `${Math.random()*100}%`;
        const x2 = `${Math.random()*100}%`;
        const y2 = `${Math.random()*100}%`;
        const dur = (5.5 + Math.random()*6.5).toFixed(2) + "s";
        const scale = (0.85 + Math.random()*0.55).toFixed(2);

        s.style.left = x1;
        s.style.top  = y1;
        s.style.setProperty("--x1", "0px");
        s.style.setProperty("--y1", "0px");
        s.style.setProperty("--x2", (Math.random() > .5 ? "" : "-") + (8 + Math.random()*18).toFixed(0) + "px");
        s.style.setProperty("--y2", (Math.random() > .5 ? "" : "-") + (10 + Math.random()*22).toFixed(0) + "px");
        s.style.setProperty("--dur", dur);
        s.style.setProperty("--s", scale);

        floaty.appendChild(s);
      }
    }

    // ---------- Interactions ----------
    items.forEach((btn, idx) => {
      btn.addEventListener("click", () => {
        if(btn.classList.contains("found")) return;

        btn.classList.add("found");
        foundCount = Math.min(4, foundCount + 1);

        showToast(clueLines[idx] || "Found üíñ");
        updateProgress();

        // tiny sparkle burst at click
        const r = btn.getBoundingClientRect();
        burstHearts(r.left + r.width/2, r.top + r.height/2, 10, 650);
      });

      // playful hover clue (desktop)
      btn.addEventListener("mouseenter", () => {
        if(foundCount < 4 && !btn.classList.contains("found")){
          showToast("psst‚Ä¶ tap me üíå");
        }
      });
    });

    // Allow "searching" clicks on empty board to tease
    board.addEventListener("click", (e) => {
      // If clicking overlay buttons, ignore
      if(e.target.closest(".seek") || e.target.closest(".proposalBox")) return;
      if(foundCount < 4){
        const messages = ["Not there‚Ä¶ but cute try üòö", "Warmer‚Ä¶ maybe üòå", "Look for the sparkles ‚ú®", "It‚Äôs hiding in plain sight üëÄ"];
        showToast(messages[Math.floor(Math.random()*messages.length)]);
      }
    });

    // ---------- Final actions ----------
    $("#againBtn").addEventListener("click", () => {
      // Reset
      foundCount = 0;
      items.forEach(btn => btn.classList.remove("found"));
      updateProgress();
      placeItems();
      buildFloaties();
      showToast("Again! Find them all ‚ú®");
    });

    $("#yesBtn").addEventListener("click", () => {
      showToast("He said YES üíñ");
      celebrate();
    });

    // ---------- Music (optional) ----------
    // Uses WebAudio so there's no external file needed.
    // A gentle dreamy pad made from 2 oscillators + lowpass filter.
    let audioCtx = null;
    let master = null;
    let isMusicOn = false;

    const musicBtn = $("#musicBtn");
    const musicDot = $("#musicDot");
    const musicIcon = $("#musicIcon");
    const musicLabel = $("#musicLabel");

    function startMusic(){
      if(isMusicOn) return;

      audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
      master = audioCtx.createGain();
      master.gain.value = 0.0; // fade in
      master.connect(audioCtx.destination);

      const filter = audioCtx.createBiquadFilter();
      filter.type = "lowpass";
      filter.frequency.value = 650;
      filter.Q.value = 0.8;
      filter.connect(master);

      // Two detuned oscillators for a soft pad
      const osc1 = audioCtx.createOscillator();
      const osc2 = audioCtx.createOscillator();
      osc1.type = "sine";
      osc2.type = "triangle";

      // Dreamy chord-ish base via slowly moving frequencies
      osc1.frequency.value = 196; // G3
      osc2.frequency.value = 247; // B3-ish

      const g1 = audioCtx.createGain();
      const g2 = audioCtx.createGain();
      g1.gain.value = 0.11;
      g2.gain.value = 0.08;

      osc1.connect(g1); g1.connect(filter);
      osc2.connect(g2); g2.connect(filter);

      // gentle vibrato
      const lfo = audioCtx.createOscillator();
      lfo.type = "sine";
      lfo.frequency.value = 0.12;
      const lfoGain = audioCtx.createGain();
      lfoGain.gain.value = 6; // Hz variation
      lfo.connect(lfoGain);
      lfoGain.connect(osc1.frequency);
      lfoGain.connect(osc2.frequency);

      // start nodes
      const now = audioCtx.currentTime;
      osc1.start(now);
      osc2.start(now);
      lfo.start(now);

      // store for stop
      startMusic.nodes = {osc1, osc2, lfo, master};

      // fade in
      master.gain.cancelScheduledValues(now);
      master.gain.setValueAtTime(0.0001, now);
      master.gain.exponentialRampToValueAtTime(0.22, now + 1.2);

      isMusicOn = true;
      musicDot.classList.add("on");
      musicIcon.textContent = "üîä";
      musicLabel.textContent = "Music: On";
      musicBtn.setAttribute("aria-pressed","true");
    }

    function stopMusic(){
      if(!isMusicOn || !audioCtx || !startMusic.nodes) return;
      const {osc1, osc2, lfo, master: m} = startMusic.nodes;

      const now = audioCtx.currentTime;
      m.gain.cancelScheduledValues(now);
      m.gain.setValueAtTime(Math.max(m.gain.value, 0.0001), now);
      m.gain.exponentialRampToValueAtTime(0.0001, now + 0.5);

      // stop after fade
      setTimeout(() => {
        try { osc1.stop(); osc2.stop(); lfo.stop(); } catch(e){}
        startMusic.nodes = null;
      }, 650);

      isMusicOn = false;
      musicDot.classList.remove("on");
      musicIcon.textContent = "üîá";
      musicLabel.textContent = "Music: Off";
      musicBtn.setAttribute("aria-pressed","false");
    }

    musicBtn.addEventListener("click", async () => {
      // Resume audio context on user gesture (mobile/autoplay policy)
      if(!audioCtx){
        try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
        catch(e){ /* ignore */ }
      }
      if(audioCtx && audioCtx.state === "suspended"){
        try{ await audioCtx.resume(); } catch(e){}
      }

      if(isMusicOn) stopMusic();
      else startMusic();
    });

    // ---------- Celebration FX (confetti + hearts) ----------
    const fx = $("#fx");
    const ctx = fx.getContext("2d");
    let particles = [];
    let rafId = null;

    function resizeFx(){
      fx.width = window.innerWidth * devicePixelRatio;
      fx.height = window.innerHeight * devicePixelRatio;
      fx.style.width = window.innerWidth + "px";
      fx.style.height = window.innerHeight + "px";
      ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
    }
    window.addEventListener("resize", () => { resizeFx(); placeItems(); });
    resizeFx();

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function addParticle(x,y,kind){
      const colors = ["#ff6fb6", "#ffd078", "#b9a6ff", "#ffb7cf", "#ffffff"];
      particles.push({
        x, y,
        vx: rand(-3.2, 3.2),
        vy: rand(-6.6, -2.2),
        g: rand(0.10, 0.16),
        r: rand(6, 12),
        rot: rand(0, Math.PI*2),
        vr: rand(-0.14, 0.14),
        life: rand(58, 110),
        kind,
        color: colors[Math.floor(Math.random()*colors.length)],
        alpha: 1
      });
    }

    function burstHearts(x,y,n=18,lifeBoost=0){
      for(let i=0;i<n;i++){
        addParticle(x,y, Math.random()>.55 ? "heart" : "confetti");
        particles[particles.length-1].life += lifeBoost;
      }
      startLoop();
    }

    function drawHeart(x,y,size,color,alpha,rot){
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(rot);
      ctx.globalAlpha = alpha;
      ctx.fillStyle = color;

      const s = size / 18;
      ctx.beginPath();
      ctx.moveTo(0, 6*s);
      ctx.bezierCurveTo(0, 0, -10*s, 0, -10*s, 6*s);
      ctx.bezierCurveTo(-10*s, 12*s, 0, 16*s, 0, 18*s);
      ctx.bezierCurveTo(0, 16*s, 10*s, 12*s, 10*s, 6*s);
      ctx.bezierCurveTo(10*s, 0, 0, 0, 0, 6*s);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }

    function drawConfetti(x,y,w,color,alpha,rot){
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(rot);
      ctx.globalAlpha = alpha;
      ctx.fillStyle = color;
      ctx.fillRect(-w/2, -w/2, w, w*0.7);
      ctx.restore();
    }

    function loop(){
      rafId = requestAnimationFrame(loop);
      ctx.clearRect(0,0, window.innerWidth, window.innerHeight);

      particles = particles.filter(p => p.life > 0);
      for(const p of particles){
        p.life -= 1;
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        p.alpha = Math.max(0, Math.min(1, p.life/90));

        if(p.kind === "heart"){
          drawHeart(p.x, p.y, p.r*2.2, p.color, p.alpha, p.rot);
        } else {
          drawConfetti(p.x, p.y, p.r*1.7, p.color, p.alpha, p.rot);
        }
      }

      if(particles.length === 0){
        cancelAnimationFrame(rafId);
        rafId = null;
      }
    }

    function startLoop(){
      if(!rafId) loop();
    }

    function celebrate(){
      // A few bursts around the center + one from YES button position
      const yes = $("#yesBtn").getBoundingClientRect();
      burstHearts(yes.left + yes.width/2, yes.top + yes.height/2, 26, 80);
      burstHearts(window.innerWidth*0.25, window.innerHeight*0.35, 18, 60);
      burstHearts(window.innerWidth*0.75, window.innerHeight*0.35, 18, 60);
      burstHearts(window.innerWidth*0.5,  window.innerHeight*0.22, 20, 70);

      // Also pulse the message a little
      const box = document.querySelector(".proposalBox");
      box.animate(
        [{transform:"translateY(0) scale(1)"},{transform:"translateY(-2px) scale(1.02)"},{transform:"translateY(0) scale(1)"}],
        {duration:800, easing:"cubic-bezier(.2,.8,.2,1)"}
      );
    }

    // ---------- Init ----------
    buildFloaties();
    // Defer placing items till after layout
    requestAnimationFrame(() => {
      placeItems();
      updateProgress();
      // Tiny intro toast
      setTimeout(() => showToast("Find 4 hidden cards üíå"), 550);
    });
  </script>
</body>
</html>
